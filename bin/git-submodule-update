#!/usr/bin/env ruby

%x[git submodule update]
%x[git submodule foreach git pull origin master]

submodules = %x[git status | grep "modified.*\(new commits\)" | awk '{print $3}'].split("\n").map(&:strip)

if submodules.any?
  puts "Updating #{submodules.size} submodule(s)..."
  submodules.each { |name| %x[git add #{name}] }
  commit_message = "Updating submodules:\n"
  commit_message << submodules.map { |name| "* #{name}" }.join("\n")
  %x[git commit -m "#{commit_message}"]
else
  puts "No submodules to update"
end

