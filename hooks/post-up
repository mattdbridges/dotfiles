#!/bin/zsh

if [ ! -e "$HOME/.zprezto" ]; then
  echo "==> Installing Prezto..."
  git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto" &> /dev/null
  setopt EXTENDED_GLOB
  for rcfile in "${ZDOTDIR:-$HOME}"/.zprezto/runcoms/^README.md(.N); do
    if [ ! -f "$HOME/.${rcfile:t}" ]; then
      ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
    fi
  done
else
  echo "==> Updating Prezto..."
  cd "${ZDOTDIR:-$HOME}/.zprezto" &> /dev/null
  git pull >/dev/null 2>&1
  git submodule update >/dev/null 2>&1
  cd - &> /dev/null
fi

echo "==> Preparing minpac for Vim"
mkdir -p ~/.config/nvim/pack/minpac/opt
rm -f $HOME/.config/nvim/init.vim
ln -s $HOME/.vimrc $HOME/.config/nvim/init.vim
cd "$HOME/.config/nvim/pack/minpac/opt" &> /dev/null
git clone https://github.com/k-takata/minpac.git
cd - &> /dev/null

# Install iTerm2 Configured Font
cp $HOME/.dotfiles/fonts/* $HOME/Library/Fonts

echo "==> Installing Homebrew dependencies"                   ; brew bundle --global --no-upgrade
echo "==> Adding $HOME/.localbin directory for other scripts" ; mkdir "$HOME/.localbin" >/dev/null 2>&1
echo "==> Installing vim packages..."                         ; vim +PackUpdate
echo "==> Installing starred apm packages"                    ; apm i --packages-file "$HOME/.atom/package-list.txt"
